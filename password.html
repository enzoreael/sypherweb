<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>New tab</title>
  <link rel="icon" href="https://www.google.com/s2/favicons?sz=256&domain_url=https%3A%2F%2Fgoogle.com">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #7b61ff;
      --primary-dark: #5f3dc6;
      --primary-light: #f5f2ff;
      --text: #0f1724;
      --text-muted: #6b7280;
      --error: #ff4757;
      --error-light: #ffe6e9;
      --bg: linear-gradient(180deg, #fbfbfd 0%, #f7f6fb 100%);
      --card-bg: rgba(255, 255, 255, 0.90);
      --card-border: rgba(2, 6, 23, 0.04);
      --card-shadow: 0 18px 70px rgba(91, 33, 182, 0.06);
      --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      transition: var(--transition);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .container {
      max-width: 600px;
      width: 100%;
      margin: 0 auto;
      padding: 20px;
    }

    .auth-card {
      background: var(--card-bg);
      backdrop-filter: blur(10px) saturate(120%);
      -webkit-backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid var(--card-border);
      border-radius: 20px;
      padding: 40px;
      box-shadow: var(--card-shadow);
      transition: var(--transition);
      text-align: center;
    }

    .auth-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 80px rgba(91, 33, 182, 0.12);
    }

    .brand {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
    }

    .brand-logo {
      width: 60px;
      height: 60px;
      border-radius: 12px;
      transition: var(--transition);
    }

    .brand-text {
      text-align: left;
    }

    .brand-title {
      font-size: 2.2rem;
      font-weight: 800;
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      line-height: 1.1; /* Fixed line-height to prevent cutting off */
      margin-bottom: 5px;
      padding-bottom: 2px; /* Added padding to ensure full visibility */
    }

    .brand-subtitle {
      font-size: 1rem;
      color: var(--text-muted);
    }

    .auth-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 10px;
      color: var(--text);
    }

    .auth-subtitle {
      font-size: 1.1rem;
      color: var(--text-muted);
      margin-bottom: 30px;
    }

    .pass-row {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 25px 0;
    }

    .cube {
      width: 70px;
      height: 70px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 24px;
      color: var(--text);
      border: 1px solid var(--card-border);
      box-shadow: 0 8px 20px rgba(12, 10, 22, 0.06);
      user-select: none;
      position: relative;
      transition: var(--transition);
      cursor: pointer;
    }

    .cube:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 25px rgba(91, 33, 182, 0.15);
    }

    .cube:active {
      transform: translateY(1px);
    }

    .cube.empty {
      color: rgba(11, 17, 27, 0.2);
    }

    .cube.error {
      background-color: var(--error-light);
      border-color: var(--error);
      color: var(--error);
      animation: pulseError 0.5s ease-in-out;
    }

    @keyframes pulseError {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); background-color: rgba(255, 71, 87, 0.2); }
      100% { transform: scale(1); }
    }

    .caret {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 3px;
      height: 28px;
      background: var(--primary);
      border-radius: 2px;
      animation: caret-blink 900ms ease-in-out infinite;
      box-shadow: 0 0 8px rgba(123, 97, 255, 0.3);
    }

    @keyframes caret-blink {
      0% {
        opacity: 1;
        transform: translate(-50%, -50%) scaleY(1);
      }
      50% {
        opacity: 0;
        transform: translate(-50%, -50%) scaleY(0.98);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scaleY(1);
      }
    }

    .actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 25px;
    }

    .btn {
      padding: 12px 24px;
      border-radius: 12px;
      border: none;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn.ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--card-border);
    }

    .btn.ghost:hover {
      background: rgba(123, 97, 255, 0.05);
      color: var(--primary);
      transform: translateY(-2px);
    }

    .btn.primary {
      background: linear-gradient(90deg, var(--primary), var(--primary-dark));
      color: white;
      box-shadow: 0 8px 20px rgba(91, 33, 182, 0.2);
    }

    .btn.primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 25px rgba(91, 33, 182, 0.3);
    }

    .hint {
      font-size: 0.9rem;
      color: var(--text-muted);
      margin-top: 20px;
    }

    .secret-input {
      position: absolute;
      left: -9999px;
      opacity: 0;
      width: 1px;
      height: 1px;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    .shake {
      animation: shake 0.6s cubic-bezier(.36,.07,.19,.97) both;
    }

    @media (max-width: 520px) {
      .auth-card {
        padding: 30px 20px;
      }
      
      .cube {
        width: 60px;
        height: 60px;
        font-size: 20px;
      }
      
      .brand-title {
        font-size: 1.8rem;
      }
      
      .auth-title {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="auth-card" role="dialog" aria-labelledby="gate-title" aria-describedby="gate-desc">
      <div class="brand">
        <img class="brand-logo" src="https://static.wixstatic.com/media/a3a3cf_7fe0f60fa9d94a88ac2beaa6a9c41e6f~mv2.png" alt="Sypher logo">
        <div class="brand-text">
          <div class="brand-title">Sypher</div>
          <div class="brand-subtitle">Secure Access</div>
        </div>
      </div>

      <h1 id="gate-title" class="auth-title">Protected Access</h1>
      <p id="gate-desc" class="auth-subtitle">This area is restricted to authorized members. Enter the 4-digit access code to continue.</p>

      <div class="pass-row" id="pass-row" aria-hidden="false">
        <div class="cube empty" data-index="0" tabindex="0" role="button" aria-label="Digit 1"></div>
        <div class="cube empty" data-index="1" tabindex="0" role="button" aria-label="Digit 2"></div>
        <div class="cube empty" data-index="2" tabindex="0" role="button" aria-label="Digit 3"></div>
        <div class="cube empty" data-index="3" tabindex="0" role="button" aria-label="Digit 4"></div>
      </div>

      <div style="position:relative">
        <input id="secret" class="secret-input" inputmode="numeric" pattern="[0-9]*" autocomplete="one-time-code" />
      </div>

      <div class="actions" aria-hidden="false">
        <button class="btn ghost" id="clearBtn">
          <i class="fas fa-eraser"></i> Clear
        </button>
        <button class="btn primary" id="submitBtn">
          <i class="fas fa-lock-open"></i> Enter
        </button>
      </div>

      <div class="hint">Type the 4-digit access code or tap the boxes. Use backspace to correct.</div>
    </div>
  </div>

  <script>
  (function(){
    // Current password stored in localStorage under 'sypher-password' (default "2025")
    const currentPassword = localStorage.getItem("sypher-password") || "2025";

    const cubes = Array.from(document.querySelectorAll('.cube'));
    const secret = document.getElementById('secret');
    const clearBtn = document.getElementById('clearBtn');
    const submitBtn = document.getElementById('submitBtn');
    const authCard = document.querySelector('.auth-card');

    let buffer = ["", "", "", ""];
    let cursor = 0;

    function render(){
      cubes.forEach((c, i) => {
        c.innerHTML = "";
        if (buffer[i]) {
          c.textContent = buffer[i];
          c.classList.remove("empty");
        } else {
          c.classList.add("empty");
          if (i === cursor && document.hasFocus()) {
            const caret = document.createElement("div");
            caret.className = "caret";
            c.appendChild(caret);
          } else {
            const dot = document.createElement("span");
            dot.textContent = "●";
            dot.style.opacity = "0.28";
            dot.style.fontSize = "18px";
            c.appendChild(dot);
          }
        }
      });
    }

    function focusInput(){
      try { secret.focus({preventScroll:true}); } catch (e) { secret.focus(); }
      render();
    }

    function pushDigit(ch){
      if (cursor >= 4) return;
      if (!/^\d$/.test(ch)) return;
      buffer[cursor] = ch;
      cursor++;
      render();
      if (cursor === 4) setTimeout(trySubmit, 180);
    }

    function backspace(){
      if (cursor <= 0) return;
      cursor--;
      buffer[cursor] = "";
      render();
    }

    function clearAll(){
      buffer = ["", "", "", ""];
      cursor = 0;
      render();
      focusInput();
    }

    function trySubmit(){
      const code = buffer.join("");
      if (code === currentPassword) {
        localStorage.setItem('sypher-unlocked', 'true');
        localStorage.setItem('sypher-unlock-password', currentPassword);
        // redirect to the stored try-url (if any) or index.html
        const tryUrl = localStorage.getItem('sypher-try-url') || 'index.html';
        localStorage.removeItem('sypher-try-url');
        window.location.replace(tryUrl);
      } else {
        // Enhanced error animation
        authCard.classList.add('shake');
        
        // Add red error state to cubes
        cubes.forEach(cube => {
          cube.classList.add('error');
        });
        
        setTimeout(() => {
          authCard.classList.remove('shake');
          cubes.forEach(cube => {
            cube.classList.remove('error');
          });
          clearAll();
        }, 1000);
      }
    }

    secret.addEventListener('keydown', (e) => {
      if (e.key === 'Backspace' || e.key === 'Delete') { e.preventDefault(); backspace(); return; }
      if (e.key === 'Enter') { e.preventDefault(); trySubmit(); return; }
      if (/^\d$/.test(e.key)) { e.preventDefault(); pushDigit(e.key); return; }
    });

    secret.addEventListener('paste', (e) => {
      e.preventDefault();
      const pasted = (e.clipboardData || window.clipboardData).getData('text') || '';
      const digits = pasted.replace(/\D/g, '').slice(0,4).split('');
      if (digits.length) {
        clearAll();
        digits.forEach(d => pushDigit(d));
      }
    });

    cubes.forEach((c, i) => {
      c.addEventListener('click', () => {
        cursor = i;
        render();
        focusInput();
        c.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 220 });
      });
      c.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter') { focusInput(); }
        if (ev.key === 'Backspace') { backspace(); }
      });
    });

    clearBtn.addEventListener('click', (e) => { e.preventDefault(); clearAll(); });
    submitBtn.addEventListener('click', (e) => { e.preventDefault(); trySubmit(); });

    // Init
    render();
    setTimeout(focusInput, 120);

    // If the user is already unlocked with the current password, go back to index.html immediately
    const unlocked = localStorage.getItem('sypher-unlocked') === 'true';
    const unlockedWith = localStorage.getItem('sypher-unlock-password');
    if (unlocked && unlockedWith === currentPassword) {
      const tryUrl = localStorage.getItem('sypher-try-url') || 'index.html';
      localStorage.removeItem('sypher-try-url');
      window.location.replace(tryUrl);
    } else {
      // force re-login if password changed or not unlocked
      localStorage.removeItem('sypher-unlocked');
      localStorage.removeItem('sypher-unlock-password');
    }

    // --- small admin helper to change password and force logout from console:
    // Usage: SypherAdmin.setPassword('4321')  OR SypherAdmin.logoutAll()
    window.SypherAdmin = {
      setPassword: function(p){
        localStorage.setItem('sypher-password', String(p));
        // clearing unlocked forces all users to re-enter the new password
        localStorage.removeItem('sypher-unlocked');
        localStorage.removeItem('sypher-unlock-password');
        console.info('Sypher password changed and users logged out.');
      },
      logoutAll: function(){
        localStorage.removeItem('sypher-unlocked');
        localStorage.removeItem('sypher-unlock-password');
        console.info('All users have been logged out.');
      }
    };
  })();
  </script>
</body>
</html>